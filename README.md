# 六角形コッホ曲線アプリ | Jimitas.com 地味に助かる学習コンテンツ

## プロジェクト概要

雪の結晶をモチーフにした六角形ベースのコッホ曲線を描画するWebアプリケーション。ユーザーが直感的に操作でき、美しいアニメーションで描画過程を楽しめるインタラクティブなアプリです。

**Jimitas.com - 地味に助かる学習コンテンツ**の一部として、中学生から高校生向けに数学・理科の学習を視覚的にサポートする無料教育ツールです。

## 技術仕様

- **フロントエンド**: HTML5, CSS3, JavaScript (Vanilla)
- **描画**: Canvas API
- **デザイン**: レスポンシブデザイン（デスクトップ・モバイル対応）

## 機能要件

### 1. コッホ曲線描画機能

- **基本形状**: 正六角形をベースとした図形
- **レベル選択**: 0〜5の6段階でコッホ曲線の複雑さを選択
  - レベル0: 正六角形
  - レベル1-5: 各段階で再帰的にコッホ曲線変換を適用
- **描画方向**: 内側・外側の2つのモード
  - 内側モード: 六角形の内側に向かって折れ曲がり
  - 外側モード: 六角形の外側に向かって折れ曲がり（雪の結晶のような形状）
- **表示モード**: 2つの表示方式
  - 六角形モード: 完全な六角形のコッホ曲線を表示
  - 1辺拡大モード: 六角形の1辺のみをキャンバス幅90%に拡大表示（詳細観察用）

### 2. ユーザーインターフェース

#### レベル選択ボタン
- 0〜5の数字ボタン（6個）
- アクティブ状態の視覚的フィードバック
- 初期状態では何も選択されていない
- リッチなガラスモーフィズムデザイン
- ホバー時のシマーエフェクトとスケールアニメーション

#### 方向切り替えトグル
- スライダー式のトグルボタン
- 「内側」「外側」のテキスト表示
- 外側モード時は文字が左寄せになり視認性を確保
- グラデーション背景とアニメーション効果

#### 表示モード切り替えチェックボックス
- 「1辺だけ拡大表示」オプション
- カスタムデザインチェックボックス
- チェック時の青色グラデーション効果
- リアルタイムでの表示モード切り替え

### 3. アニメーション機能

- **描画アニメーション**: 一筆書きのような順次描画
- **アダプティブ時間**:
  - 六角形モード: 5秒間
  - 1辺拡大モード: 3秒間（よりテンポ良く）
- **速度調整**: レベル0はゆっくり、レベル5は速く見える（描画点数の違いによる）
- **六角形ローディングアニメーション**: 描画開始前の1秒間表示

### 4. 操作制御・フィードバック

#### 操作ブロック機能
- アニメーション実行中は他の操作をブロック
- ブロック時にトースト通知を表示「描画中です。お待ちください...」

#### ユーザーガイダンス
- 初期ロード時: 1秒後に「レベルボタン（0〜5）を押してください」を表示
- トグル切り替え時: レベル選択状態をリセット＋ガイダンス表示

## 非機能要件

### 1. レスポンシブデザイン

#### デスクトップ（768px以上）
- キャンバス最大サイズ: 600px × 600px
- コントロールボタンは横並び配置

#### モバイル（768px未満）
- 画面サイズに応じたキャンバスサイズ調整
- コントロールボタンは縦並び配置
- 最小サイズ300px保証

### 2. 描画サイズ最適化

- **キャンバス**: 正方形で画面に収まるサイズ
- **描画サイズ**: キャンバスサイズの40%（baseRadius = size * 0.40）
- **レベル対応**: 最も複雑な図形でも画面内に収まる
- **線の太さ**: レベルに応じて自動調整
  - レベル0-1: 2px
  - レベル2-3: 1.5px
  - レベル4-5: 0.7px（細部の視認性向上）

### 3. UI/UXデザイン

#### デザインテーマ
- 雪の結晶をイメージした青系グラデーション背景
- ガラスモーフィズム効果（backdrop-filter）
- 半透明要素を多用した現代的なデザイン
- リッチなアニメーション効果とマイクロインタラクション
- **ユニバーサルデザイン対応**（色弱・高齢者・アクセシビリティ配慮）

#### カラーパレット（ユニバーサルデザイン対応）
- 背景: 動的な3色グラデーション（#667eea → #764ba2 → #4a90e2）
- ボタン: 多層グラデーションと高級シャドウ効果
- アクティブ状態: 高コントラスト白背景 + 太いボーダー（3px）
- チェックボックス: 濃い青系グラデーション（#1e40af → #0f172a）
- トースト通知: 濃い青系（#1e40af → #0f172a）※赤系を排除
- タイトル: 純白テキスト + 高コントラストシャドウ
- 描画色: ダークグレー（#2c3e50）

#### アクセシビリティ仕様
- **色弱対応**: 赤緑色弱、青黄色弱に配慮した青系中心配色
- **高コントラスト**: WCAG 2.1 AAレベルに近い対比率
- **パターン識別**: 色だけでなく境界線やシャドウでの視覚的差別化
- **視認性**: 純色使用により、どの色覚タイプでも明確に識別可能

## 技術実装詳細

### 1. アルゴリズム

#### コッホ曲線変換
1. 線分を3等分
2. 中央の線分を削除
3. 削除した位置に正三角形を描画
4. レベルに応じて再帰的に適用

#### 方向制御
```javascript
const heightDirection = this.isOutward ? -1 : 1;
```

### 2. 状態管理

- `currentLevel`: 現在選択されているレベル（null = 未選択）
- `isOutward`: 描画方向（false = 内側, true = 外側）
- `isSingleEdgeMode`: 表示モード（false = 六角形, true = 1辺拡大）
- `isAnimating`: アニメーション実行中フラグ

### 3. キャンバスサイズ計算

```javascript
// 利用可能な高さ = 画面高さ - ヘッダー・コントロール分
const availableHeight = window.innerHeight - 300;

// デスクトップ
maxSize = Math.min(600, window.innerWidth - 100, availableHeight);

// モバイル
maxSize = Math.min(availableHeight, window.innerWidth - 60);
```

## ファイル構成

```
koch-curve-app/
├── index.html          # メインHTML
├── style.css           # スタイルシート
├── script.js           # JavaScript実装
└── README.md           # 要件定義書（本ファイル）
```

## 動作フロー

1. **初期化**
   - ページ読み込み
   - 空のキャンバス表示
   - 1秒後にガイダンス表示

2. **レベル選択**
   - レベルボタンクリック
   - アクティブ状態更新
   - 六角形ローディング表示（1秒間）
   - アダプティブ時間でアニメーション実行

3. **設定変更**
   - 方向トグル/表示モードチェックボックス変更
   - 全状態リセット
   - ガイダンス表示

4. **表示モード**
   - 六角形モード: 完全な六角形描画
   - 1辺拡大モード: 左端5%〜右端95%の水平線に描画

5. **再描画**
   - 画面リサイズ時の自動調整
   - アニメーションなしで即座に描画

## 品質要件

- **パフォーマンス**: 60FPSでのスムーズなアニメーション
- **互換性**: モダンブラウザ対応（Canvas API, CSS3サポート必須）
- **アクセシビリティ**:
  - WCAG 2.1 AAレベルに準拠したコントラスト比
  - 色弱対応（赤緑色弱・青黄色弱・全色弱）
  - キーボード操作対応、明確な視覚的フィードバック
  - ユニバーサルデザイン（高齢者・視覚障害者配慮）
- **保守性**: 単一責任の原則に基づいたクラス設計
- **インクルーシブデザイン**: 全ての利用者が快適に使用できる設計

## SEO・メタ情報要件

### 1. SEO最適化

#### メタタグ設定
- **タイトル**: 「六角形コッホ曲線 - 雪の結晶から学ぶフラクタル幾何学 | Jimitas.com 地味に助かる学習コンテンツ」
- **ディスクリプション**: Jimitas.com 地味に助かる学習コンテンツ - 無料で使える数学・理科の学習ツール。フラクタル幾何学を美しいアニメーションで視覚的に理解。中学・高校生向け。
- **キーワード**:
  - **ブランド**: jimitas, jimitas.com, 地味に助かる
  - **教科**: 中学数学, 高校数学, 理科, 図形, 幾何学
  - **トピック**: コッホ曲線, フラクタル, 六角形, 雪の結晶, 結晶構造
  - **学習**: 無料教材, オンライン学習, STEM教育, 数学教材, インタラクティブ, ビジュアル学習
  - **機能**: 学習ツール, アニメーション, 教育コンテンツ
- **著者情報**: Jimitas.com
- **ロボット指示**: index, follow
- **言語**: ja
- **canonical URL**: https://jimitas.com/koch-curve-app/

#### ソーシャルメディア対応
- **Open Graph**（Facebook用）
  - タイトル、ディスクリプション、サイト名を設定
  - ウェブサイトタイプとして定義
- **Twitter Card**
  - summary_large_image形式
  - 魅力的なタイトルと説明文

### 2. 構造化データ（Schema.org）

#### LearningResource形式
```json
{
    "@context": "https://schema.org",
    "@type": "LearningResource",
    "name": "六角形コッホ曲線 - Jimitas.com",
    "description": "Jimitas.com 地味に助かる学習コンテンツ - 六角形ベースのコッホ曲線を美しいアニメーションで描画できる無料学習ツール",
    "educationalLevel": "中学生〜高校生",
    "learningResourceType": "Interactive Tool",
    "url": "https://jimitas.com/koch-curve-app/",
    "inLanguage": "ja",
    "isAccessibleForFree": true,
    "keywords": "数学,理科,フラクタル,幾何学,コッホ曲線,中学数学,高校数学,STEM教育",
    "about": ["フラクタル幾何学", "コッホ曲線", "数学", "理科", "結晶構造"],
    "provider": {
        "@type": "Organization",
        "name": "Jimitas.com",
        "description": "地味に助かる学習コンテンツ",
        "url": "https://jimitas.com",
        "sameAs": [
            "https://github.com/jimitas",
            "https://twitter.com/jimitas"
        ]
    }
}
```

### 3. 教育コンテンツ戦略

#### ターゲット層
- **主要**: 中学生〜高校生
- **副次**: 数学教師、保護者
- **検索意図**: フラクタル学習、視覚的理解、インタラクティブ教材

#### コンテンツ価値
- 数学の抽象概念を視覚化
- 自然界（雪の結晶）との関連性
- 段階的学習（レベル0-5）
- インタラクティブな体験学習

### 4. Jimitas ブランド統合

#### ブランドメッセージ
- 「地味に助かる学習コンテンツ」の理念
- 実用性と教育価値の両立
- 視覚的でわかりやすい学習体験

#### サイト連携
- jimitas.comとの一貫性
- 同じ品質基準とユーザビリティ
- 教育コンテンツとしての位置づけ

## 技術実装のSEO考慮事項

### HTMLセマンティクス
- `<h1>`でメインタイトル
- 適切な見出し構造
- `lang="ja"`属性の設定

### パフォーマンス最適化
- 軽量なバニラJavaScript
- CSS3の効率的な利用
- モバイルフレンドリー設計

## 更新履歴

### 2025年9月21日
- 初期ローディング時の「描画中」表示バグを修正
- SEO対策を強化（Jimitas.comブランドを明確化）
- メタタグを最適化（教科名・学習内容キーワードを追加）
- 構造化データ（Schema.org）を更新
- READMEにSEO対策の詳細を記載

## 今後の拡張可能性

### 機能拡張
- 描画色の変更機能
- アニメーション速度調整
- SVGでの描画出力
- 画像ダウンロード機能
- より多くの初期図形（三角形、五角形など）

### アクセシビリティ拡張
- スクリーンリーダー対応（ARIA属性）
- キーボードナビゲーション強化
- ハイコントラストモード
- 文字サイズ調整機能
- 音声ガイダンス機能

### SEO・マーケティング拡張
- 教育的解説コンテンツの追加
- 数学概念の詳細説明ページ
- 関連する学習ツールとの内部リンク
- ユーザー投稿機能（作品ギャラリー）
- 多言語対応（英語版）

## ユニバーサルデザイン設計指針

### 1. 色覚多様性への配慮
- **主要色相**: 青系（#1e40af）を中心とした配色
- **避けるべき色**: 赤・緑・オレンジ系の組み合わせ
- **代替手段**: 色に依存しないパターン・形状・位置での情報伝達

### 2. 視覚的コントラスト
- **文字コントラスト比**: 4.5:1以上（WCAG AA準拠）
- **UI要素コントラスト比**: 3:1以上
- **境界線強化**: アクティブ状態は3px太線で明確化

### 3. 認知負荷軽減
- **一貫したUI**: 同一機能は同一デザインパターン
- **明確なフィードバック**: 操作結果の即座表示
- **段階的開示**: 必要な情報のみを適切なタイミングで表示

この設計により、色覚の多様性、視覚能力の差、年齢による変化に関係なく、全ての利用者が数学の美しさを体験できる学習ツールを実現。